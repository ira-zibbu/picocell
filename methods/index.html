<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Methods - picocell</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script>
   
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    };
  </script>

    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">picocell</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../introduction/" class="nav-link">Introduction</a>
                            </li>
                            <li class="nav-item">
                                <a href="./" class="nav-link active" aria-current="page">Methods</a>
                            </li>
                            <li class="nav-item">
                                <a href="../results/" class="nav-link">Results</a>
                            </li>
                            <li class="nav-item">
                                <a href="../code/" class="nav-link">Code</a>
                            </li>
                            <li class="nav-item">
                                <a href="../refs/" class="nav-link">References</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../introduction/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../results/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#methods" class="nav-link">Methods</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#set-up" class="nav-link">Set up</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#genetic-drift" class="nav-link">Genetic Drift</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#natural-selection" class="nav-link">Natural Selection</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#mutation" class="nav-link">Mutation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#genotype-phenotype-fitness-mapping" class="nav-link">Genotype-Phenotype-Fitness Mapping</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="methods">Methods</h1>
<p><code>picocell</code>'s workflow is outlined in the following schematic:</p>
<p><img alt="methods" src="../methods_overview.png" /></p>
<h2 id="set-up">Set up</h2>
<p>Picocell is set up as a series of decision trees that are applied to each cell at each generation. Each cell is implemented as Python object with the following attributes:</p>
<pre><code class="language-python">class cell:

    &quot;&quot;&quot; A class that represents a cell  &quot;&quot;&quot;

    def __init__(self, id=0, dna_sequence=&quot;&quot;,aa_sequence=&quot;&quot;,fitness=0.0,mutation_rate=0.0, generation=0, death=0):
        self.id = id # each cell has an integer ID number to keep track of it
        self.dna_sequence = dna_sequence # a string that represents the DNA sequence
        self.aa_sequence = aa_sequence # a string that represents the DNA sequence
        self.fitness = fitness # float that represents the fitness of the cell, based on its sequence
        self.mutation_rate = mutation_rate # a float that is the per-base per-generation mutation rate
        self.generation = generation # an int indicating the generation in which the cell is born
        self.death = death # an int indicating the generation in which the cell dies
</code></pre>
<p>Each cell has the DNA sequence corresponding to the coding sequence of a Cas12f protein from <em>Acidibacillus sulfuroxidans</em> i.e. the whole genome is a single ORF. In addition to these cellular attributes, there are two variables associated with each simulation: the level of genetic drift <span class="arithmatex">\(d\)</span> and the presence/absence of natural selection. </p>
<h2 id="genetic-drift">Genetic Drift</h2>
<p>The genetic drift level <span class="arithmatex">\(d\)</span> represents the probability that a cell is killed in that generation. This probability is constant across the generations, and is independent of the sequence or the fitness of the cell.</p>
<div class="arithmatex">\[P(\text{death}) = d\]</div>
<div class="arithmatex">\[P(\text{live}) = 1-d\]</div>
<h2 id="natural-selection">Natural Selection</h2>
<p>Each cell has a sequence, and each sequence has a corresponding 'fitness'. In the context of the Cas12f protein, this is the genome editing efficiency, normalized by the activity of the wildtype sequence. The fitness of the wildtype sequence is 1, and mutants with greater editing efficiency than the wildtype have a fitness of &gt;1 while those with lower editing efficiency have a fitness value &lt;1. </p>
<p>In order to use the fitness to inform the growth of the cells, each cell has a probability of dividing that is equal to their fitness <span class="arithmatex">\(f\)</span> scaled by a factor <span class="arithmatex">\(\kappa\)</span>.</p>
<div class="arithmatex">\[P(\text{divide}) = \kappa f\]</div>
<div class="arithmatex">\[P(\text{no division}) = 1 - \kappa f\]</div>
<h2 id="mutation">Mutation</h2>
<p>Once a cell 'decides' to divide, the opportunity for mutations to occur arises. Each cell has a mutation rate <span class="arithmatex">\(\mu\)</span> which is defined as the per base per generation probability of generating a mutation. Formally,</p>
<div class="arithmatex">\[ \text{Let } S \text{ denote the sequence of the parental cell, where } S=\{B_1,B_2..B_n\} \text{ is a sequence of N bases}\]</div>
<div class="arithmatex">\[ \forall B_i \in S, P(B_i\rightarrow B_i')=\mu \]</div>
<div class="arithmatex">\[ \text{where } B_i \neq B_i' \text{ and } B_i \text{ represents the wildtype base and } B_i' \text{ represents the mutant base}\]</div>
<p>Each base has an equal chance to mutating to any other base, i.e. there is no mutational bias.</p>
<h2 id="genotype-phenotype-fitness-mapping">Genotype-Phenotype-Fitness Mapping</h2>
<p>After a cell divides, there are four possible outcomes for the child cell:</p>
<ol>
<li>No mutation: The child cell has the same sequence and fitness as the parental cell</li>
<li>Synonymous mutation: The child cell has a different DNA sequence, but the same fitness as the parental cell (assuming that all synonmymous mutations are silent)</li>
<li>Nonsense mutation: As a rule, if a premature stop codon is introduced, then this is considered a lethal mutation and the child cell is killed.</li>
<li>Nonsynonymous mutation: The DNA and amino acid sequence has changed, and the fitness must be recomputed for this mutation.</li>
</ol>
<p>If the nonsynonymous mutation is present in the DMS dataset for the Cas12f protein, then the fitness value is fetched from the table. Otherwise, the embeddings are extracted for the new sequence using ESM-1b, and the embeddings are fed to a random forest regressor to map to a fitness value. For more information about how this regressor was trained, please see <a href="../code/">the code page</a>. For the ORF of length <span class="arithmatex">\(M\)</span> amino acids, ESM generates an embedding matrix <span class="arithmatex">\(E \in \mathbb{R}^{M \times D}\)</span> where <span class="arithmatex">\(D\)</span> is the dimensionality of the embedding space. The embeddings are averaged across all amino acids to generate a vector representation <span class="arithmatex">\(e \in \mathbb{R}^{D}\)</span> for the protein. Training the regressor on the DMS dataset with a random 80:20 train:test split yielded an <span class="arithmatex">\(R^2\)</span> ~ <span class="arithmatex">\(0.35\)</span>. Cross-validation to tune the hyperparameters (in this case the number of the trees in the forest) may have yielded better results. For the purposes of the project, the default value of 100 trees was used.</p>
<p>After recomputing the fitness, the newly born children cells join their parents to become parent cells for the next generation and the simulation continues for the specified number of generation.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
